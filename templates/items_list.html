{% extends 'base.html' %}
{% block content %}
<style>
.parts-table {
    width: auto;
    min-width: 100%;
    margin-top: 18px;
    border-collapse: collapse;
    font-size: 15px;
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 1px 4px #eee;
    border: 1.5px solid #c2c7d0;
}
.parts-table th {
    background: #32405a;
    color: #fff;
    padding: 10px 6px;
    border: 1px solid #ddd;
    font-weight: bold;
    white-space: nowrap;
}
.parts-table td {
    padding: 8px 6px;
    border: 1px solid #eee;
    background: #fff;
    word-break: break-word;
    text-align: center;
    vertical-align: middle;
    white-space: nowrap;
}
.parts-action-btn { padding:8px 20px;border-radius:6px;background:#007bff;color:#fff;text-decoration:none;font-weight:bold; }
@media (max-width: 900px) {
    .parts-table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; width:100%; }
}
</style>

<div class="services-table-fix" style="max-width:none;width:auto;margin-right:0;margin-left:auto;background:#f9f9f9;padding:28px 32px 22px 32px;border-radius:10px;box-shadow:0 2px 8px #eee;direction:rtl;overflow-x:auto;">
    <div style="max-width:900px;margin-right:0;margin-left:auto;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
        <span style="font-size:22px;font-weight:bold;color:#333;">قائمة الأصناف</span>
        <div style="display:flex;align-items:center;gap:12px;">
            <a href="{% url 'add_item' %}" class="parts-action-btn">إضافة صنف</a>
            <div style="color:#666;font-size:0.95em;">ابحث أو أضف صنف جديد</div>
        </div>
        <form method="get" style="display:flex;align-items:center;gap:8px;">
            <input type="text" name="q" placeholder="ابحث باسم الصنف" value="{{ q }}" style="padding:7px 10px;border-radius:5px;border:1.2px solid #c2c7d0;width:260px;">
            <button type="submit" style="background:#32405a;color:#fff;padding:7px 14px;border-radius:5px;border:none;font-weight:bold;">بحث</button>
        </form>
    </div>
    <div class="parts-table-responsive">
        <table class="parts-table">
            <thead>
                <tr>
                    <th>الاسم</th>
                    <th>المورد</th>
                    <th>القسم</th>
                    <th>الكمية</th>
                    <th>سعر المشتري</th>
                    <th>سعر البيع</th>
                    <th>إجراءات</th>
                </tr>
            </thead>
            <tbody>
            {% for p in parts %}
            <tr>
                <td style="padding:8px;border-bottom:1px solid #f6f6f6;">{{ p.name }}</td>
                <td style="padding:8px;border-bottom:1px solid #f6f6f6;">{% if p.suppliers.all %} <a href="{% url 'inventory:supplier_detail' p.suppliers.all.0.id %}">{{ p.suppliers.all.0.name }}</a> {% else %}-{% endif %}</td>
                <td style="padding:8px;border-bottom:1px solid #f6f6f6;">{% if p.department %}{{ p.department.name }}{% else %}-{% endif %}</td>
                <td style="padding:8px;border-bottom:1px solid #f6f6f6;">{{ p.quantity }}</td>
                <td style="padding:8px;border-bottom:1px solid #f6f6f6;">{{ p.purchase_price|floatformat:2 }}</td>
                <td style="padding:8px;border-bottom:1px solid #f6f6f6;">{{ p.sale_price|floatformat:2 }}</td>
                <td style="padding:8px;border-bottom:1px solid #f6f6f6;text-align:center;">
                    <div style="display:flex;gap:8px;justify-content:center;align-items:center;white-space:nowrap;">
                        <a href="{% url 'edit_item' p.id %}" style="background:#ffc107;color:#333;padding:6px 12px;border-radius:5px;text-decoration:none;font-weight:bold;">تعديل</a>
                        <a href="{% url 'delete_item' p.id %}" style="background:#e53935;color:#fff;padding:6px 12px;border-radius:5px;text-decoration:none;font-weight:bold;" onclick="return confirm('هل أنت متأكد من حذف هذا الصنف؟');">حذف</a>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="7" style="padding:12px;">لا توجد أصناف مسجلة.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if services and services.count > 0 %}
    <div style="margin-top:26px;">
        <div style="font-size:20px;font-weight:bold;color:#333;margin-bottom:10px;">الخدمات والأجزاء المرتبطة</div>
        <div style="background:#fff;border:1px solid #eee;border-radius:8px;padding:12px;">
            {% for s in services %}
            <div style="margin-bottom:12px;padding:8px;border-bottom:1px dashed #f0f0f0;">
                <div style="font-weight:bold;color:#1976d2;margin-bottom:6px;">{{ s.name }}</div>
                <div style="display:flex;flex-wrap:wrap;gap:8px;">
                    {% for sp in s.parts.all %}
                        <div style="padding:8px;border:1px solid #eee;border-radius:6px;min-width:200px;">
                            <div style="font-weight:bold;">{{ sp.name }}</div>
                            <div style="color:#666;font-size:0.95em;">الكمية: {{ sp.quantity }} — سعر المشتري: {{ sp.purchase_price|floatformat:2 }}</div>
                        </div>
                    {% empty %}
                        <div style="color:#999;">لا توجد قطع مرتبطة.</div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
{% endif %}

{% endblock %}
