{% extends 'base.html' %}
{% block content %}
<style>
.parts-table {
    width: auto;
    min-width: 100%;
    margin-top: 18px;
    border-collapse: collapse;
    font-size: 15px;
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 1px 4px #eee;
    border: 1.5px solid #c2c7d0;
}
.parts-table th {
    background: #32405a;
    color: #fff;
    padding: 10px 6px;
    border: 1px solid #ddd;
    font-weight: bold;
    white-space: nowrap;
}
.parts-table td {
    padding: 8px 6px;
    border: 1px solid #eee;
    background: #fff;
    word-break: break-word;
    text-align: center;
    vertical-align: middle;
    white-space: nowrap;
}
.parts-action-btn { padding:8px 20px;border-radius:6px;background:#007bff;color:#fff;text-decoration:none;font-weight:bold; }
.parts-table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; width:100%; }
</style>

<div class="services-table-fix" style="max-width:none;width:auto;margin-right:0;margin-left:auto;background:#f9f9f9;padding:28px 32px 22px 32px;border-radius:10px;box-shadow:0 2px 8px #eee;direction:rtl;overflow-x:auto;">
    <div style="max-width:900px;margin-right:0;margin-left:auto;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
        <span style="font-size:22px;font-weight:bold;color:#333;">قائمة فواتير المشتريات</span>
        <div style="display:flex;align-items:center;gap:12px;">
            <a href="/suppliers/" class="parts-action-btn">الموردين</a>
            <div style="color:#666;font-size:0.95em;">عرض فواتير الشراء</div>
        </div>
        <form method="get" style="display:flex;align-items:center;gap:8px;">
            <input type="text" name="q" placeholder="بحث برقم الفاتورة" value="{{ q }}" style="padding:7px 10px;border-radius:5px;border:1.2px solid #c2c7d0;width:260px;">
            <button type="submit" style="background:#32405a;color:#fff;padding:7px 14px;border-radius:5px;border:none;font-weight:bold;">بحث</button>
        </form>
    </div>

    <div class="parts-table-responsive">
        <table class="parts-table">
            <thead>
                <tr>
                    <th>رقم الفاتورة</th>
                    <th>التاريخ</th>
                    <th>المورد</th>
                    <th>المبلغ</th>
                    <th>مرتجع</th>
                    <th>إجراءات</th>
                </tr>
            </thead>
            <tbody>
                {% for p in purchases %}
                <tr>
                    <td>{{ p.invoice_number }}</td>
                    <td>{{ p.date }}</td>
                    <td><a href="{% url 'inventory:supplier_detail' supplier_id=p.supplier.id %}">{{ p.supplier.name }}</a></td>
                    <td>{{ p.amount|floatformat:2 }}</td>
                    <td>{% if p.is_return %}نعم{% else %}لا{% endif %}</td>
                    <td style="text-align:center;">
                        <div style="display:flex;gap:8px;justify-content:center;align-items:center;white-space:nowrap;">
                            <a href="{% url 'inventory:edit_purchase' purchase_id=p.id %}" style="background:#ffc107;color:#333;padding:6px 12px;border-radius:5px;text-decoration:none;font-weight:bold;">تعديل</a>
                            <a href="{% url 'inventory:delete_purchase' purchase_id=p.id %}" style="background:#e53935;color:#fff;padding:6px 12px;border-radius:5px;text-decoration:none;font-weight:bold;" onclick="return confirm('هل أنت متأكد من حذف هذه الفاتورة؟ سيتم تعديل الكميات تلقائياً.');">حذف</a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="6" style="padding:12px;text-align:center;color:#666;">لا توجد فواتير</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
